# FoodPlan 

**FoodPlan** — Telegram-бот с поддержкой Django-бэкенда и админки, помогающий пользователю выбрать рецепты по предпочтениям, собрать список покупок и оформить подписку.

## Архитектура проекта

Проект построен по принципам **чистой архитектуры**:
- бизнес-логика отделена от инфраструктурных слоёв (бота, БД, админки);
- всё, что относится к логике взаимодействия пользователя и рецептов, вынесено в `services.py`.

---

## Структура проекта

```text
foodplan/
├── bot/                # Логика Telegram-бота (handlers, FSM, запуск)
├── core/               # Общие сущности, интерфейсы и use-cases (чистая архитектура)
├── recipes/            # Модели рецептов, ингредиентов, фильтрация по категориям
├── payments/           # Подписки, планы, история оплат
├── users/              # Пользовательские профили и категории (веган, без глютена и т.д.)
├── foodplan/           # Конфигурация Django (settings, urls, wsgi/asgi)
├── docs/               # Документация (архитектура, гайд по запуску, деплой)
├── manage.py           # Django entry-point
├── requirements.txt    # Зависимости проекта
└── docker-compose.yml  # Контейнеризация
```

---

## Краткое описание модулей

### `users/`
- `Profile` — расширение `User`, хранит предпочтения и статус подписки.
- `Category` — категории блюд (Веган / Без глютена / Эконом). Используются как пользователями, так и в рецептах.
- Категории выбираются через `ManyToManyField`, булевые флаги **НЕ используются**.
- `Profile` также хранит лайки/дизлайки рецептов.

### `recipes/`
- `Recipe`, `Ingredient`, `RecipeIngredient` — основа логики рецептов.
- Рецепты привязываются к категориям (`users.Category`), и фильтруются по предпочтениям профиля.
- `services.py` — центральная точка бизнес-логики (фильтрация, выдача случайного рецепта, расчёт стоимости и т.д.).

### `payments/`
- `SubscriptionPlan` — планы подписки (например, 7 дней, 30 дней и т.д.)
- `Subscription` — подписка конкретного пользователя с датами начала/окончания.
- `PaymentRecord` — история оплат.

### `bot/`
- Telegram-бот, который будет общаться с пользователем.
- Команды, состояния, запросы рецептов и оформления подписок реализуются через `python-telegram-bot` v13.

---

## Что уже реализовано

- [x] Админка на русском языке
- [x] Категории и фильтрация рецептов по ним
- [x] Модель подписки с автоподсчётом окончания
- [x] Список покупок на основе ингредиентов
- [x] Покрытие тестами `recipes/`, `users/`, `payments/`

---

## Запуск тестов

```bash
python manage.py test recipes
python manage.py test users
python manage.py test payments
```

---

## Как развернуть локально

```bash
git clone https://github.com/your-team/foodplan.git
cd foodplan
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt

python manage.py migrate
python manage.py createsuperuser
python manage.py runserver
```
## Для запуска бота
`python manage.py runbot`
Токен телеграм бота `BOT_TOKEN` в переменной окружения в приложении `bot`